!function(e,r){if("object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=r(require("terraformer"))),"object"==typeof e.navigator){if(!e.Terraformer)throw new Error("Terraformer.ArcGIS requires the core Terraformer library. https://github.com/esri/Terraformer");e.Terraformer.ArcGIS=r(e.Terraformer)}}(this,function(e){function r(e){var r,t,o,i,n=0,s=0,a=[];o=e.match(/((\+|\-)[^\+\-]+)/g),i=parseInt(o[0],32);for(var c=1;c<o.length;c+=2)r=parseInt(o[c],32)+n,n=r,t=parseInt(o[c+1],32)+s,s=t,a.push([r/i,t/i]);return a}function t(e){return o(e[0],e[e.length-1])||e.push(e[0]),e}function o(e,r){for(var t=0;t<e.length;t++)if(e[t]!==r[t])return!1;return!0}function i(e){var r={};for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function n(e){var r,t=0,o=0,i=e.length,n=e[o];for(o;i-1>o;o++)r=e[o+1],t+=(r[0]-n[0])*(r[1]+n[1]),n=r;return t>=0}function s(e){var r=[],o=e.slice(0),i=t(o.shift().slice(0));if(i.length>=4){n(i)||i.reverse(),r.push(i);for(var s=0;s<o.length;s++){var a=t(o[s].slice(0));a.length>=4&&(n(a)&&a.reverse(),r.push(a))}}return r}function a(e){for(var r=[],t=0;t<e.length;t++)for(var o=s(e[t]),i=o.length-1;i>=0;i--){var n=o[i].slice(0);r.push(n)}return r}function c(r,t){var o=e.Tools.arrayIntersectsArray(r,t),i=e.Tools.coordinatesContainPoint(r,t[0]);return!o&&i?!0:!1}function u(e){for(var r=[],o=[],i=0;i<e.length;i++){var s=t(e[i].slice(0));if(!(s.length<4))if(n(s)){var a=[s];r.push(a)}else o.push(s)}for(;o.length;){for(var u=o.pop(),p=!1,l=r.length-1;l>=0;l--){var f=r[l][0];if(c(f,u)){r[l].push(u),p=!0;break}}p||r.push([u.reverse()])}return 1===r.length?{type:"Polygon",coordinates:r[0]}:{type:"MultiPolygon",coordinates:r}}function p(t,o){var n={};o=o||{},o.idAttribute=o.idAttribute||void 0,"number"==typeof t.x&&"number"==typeof t.y&&(n.type="Point",n.coordinates=[t.x,t.y]),t.points&&(n.type="MultiPoint",n.coordinates=t.points.slice(0)),t.paths&&(1===t.paths.length?(n.type="LineString",n.coordinates=t.paths[0].slice(0)):(n.type="MultiLineString",n.coordinates=t.paths.slice(0))),t.rings&&(n=u(t.rings.slice(0))),(t.compressedGeometry||t.geometry||t.attributes)&&(n.type="Feature",t.compressedGeometry&&(t.geometry={paths:[r(t.compressedGeometry)]}),n.geometry=t.geometry?p(t.geometry):null,n.properties=t.attributes?i(t.attributes):null,t.attributes&&(n.id=t.attributes[o.idAttribute]||t.attributes.OBJECTID||t.attributes.FID));var s=t.geometry?t.geometry.spatialReference:t.spatialReference;return s&&102100===s.wkid&&(n=e.toGeographic(n)),new e.Primitive(n)}function l(r,t){var o;t=t||{};var n=t.idAttribute||"OBJECTID";o=t.sr?{wkid:t.sr}:r&&r.crs===e.MercatorCRS?{wkid:102100}:{wkid:4326};var c,u={};switch(r.type){case"Point":u.x=r.coordinates[0],u.y=r.coordinates[1],u.spatialReference=o;break;case"MultiPoint":u.points=r.coordinates.slice(0),u.spatialReference=o;break;case"LineString":u.paths=[r.coordinates.slice(0)],u.spatialReference=o;break;case"MultiLineString":u.paths=r.coordinates.slice(0),u.spatialReference=o;break;case"Polygon":u.rings=s(r.coordinates.slice(0)),u.spatialReference=o;break;case"MultiPolygon":u.rings=a(r.coordinates.slice(0)),u.spatialReference=o;break;case"Feature":r.geometry&&(u.geometry=l(r.geometry,t)),u.attributes=r.properties?i(r.properties):{},u.attributes[n]=r.id;break;case"FeatureCollection":for(u=[],c=0;c<r.features.length;c++)u.push(l(r.features[c],t));break;case"GeometryCollection":for(u=[],c=0;c<r.geometries.length;c++)u.push(l(r.geometries[c],t))}return u}function f(t){return new e.LineString(r(t))}var g={};return g.parse=p,g.convert=l,g.toGeoJSON=p,g.fromGeoJSON=l,g.parseCompressedGeometry=f,g});